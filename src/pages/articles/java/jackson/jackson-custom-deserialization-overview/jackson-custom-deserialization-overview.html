<!DOCTYPE html>
<html lang="en">
  <head>
    ${require('common/templates/head.html')}
  </head>

  <body>
    ${require('common/templates/pre-page-loader.html')}
    <div class="page-content">
      <header></header>

      <article-webcomponent>
        <h2>Overview</h2>
        <p>
          As a Developer, exposing and consuming REST API are becoming the task number one in our job and I personally,
          believe that the <span class="code">Jackson</span> library has helped us a lot to complete these tasks with a
          clean and easy API ready for us
        </p>
        <p>
          Recently, I wanted to play around with the
          <a href="https://jsonplaceholder.typicode.com">JsonPlaceholder</a> APIs which for instance returns a response
          like this when calling its <span class="code">/user/1</span> API
        </p>

        <pre class="code" language="json">
                  {
                    "id": 1,
                    "name": "Leanne Graham",
                    "username": "Bret",
                    "email": "Sincere@april.biz",
                    "address": {
                      "street": "Kulas Light",
                      "suite": "Apt. 556",
                      "city": "Gwenborough",
                      "zipcode": "92998-3874",
                      "geo": {
                        "lat": "-37.3159",
                        "lng": "81.1496"
                      }
                    },
                    "phone": "1-770-736-8031 x56442",
                    "website": "hildegard.org",
                    "company": {
                      "name": "Romaguera-Crona",
                      "catchPhrase": "Multi-layered client-server neural-net",
                      "bs": "harness real-time e-markets"
                    }
                  }
        </pre>

        <p>
          But wait, what I really need, is only some attributes, why should I implement such huge model with its nested
          attributes ? In fact, what I really want is to define my model like this
        </p>
        <pre class="code" language="java">
              @Data
              public class User {
                  private String username;
                  private String email;
                  private String website;
              }
        </pre>

        <p>To do this, we just need to add the following jackson annotation to our model</p>

        <pre class="code" language="java">@JsonIgnoreProperties(ignoreUnknown = true)</pre>

        <p>
          And Jackson will do the unmarshalling properly using its
          <span class="code">ObjectMapper.readValue</span> method
        </p>
        <pre class="code" language="java">
              public class Main {
                  public static final String JSONPLACEHOLDER_USER_API = "https://jsonplaceholder.typicode.com/users/1";

                  public static void main(String[] args) throws IOException {
                      HttpClient httpClient = HttpClientBuilder.create().build();
                      InputStream httpResponse = httpClient
                              .execute(new HttpGet(JSONPLACEHOLDER_USER_API))
                              .getEntity().getContent();
                      ObjectMapper mapper = new ObjectMapper();
                      User user = mapper.readValue(httpResponse, User.class);
                  }
              }
        </pre>

        <p>After that, I wanted to add the company name to my model</p>
        <pre class="code" language="java">
              @Data
              @JsonIgnoreProperties(ignoreUnknown = true)
              public class User {
                  private String username;
                  private String email;
                  private String website;
                  private String company;
              }
        </pre>

        <p>
          But the company name exists in a nested object in the response of the API and the unmarchelling will not work
          with what we have done so far. To implement what I need, I found out in this
          <a href="https://www.baeldung.com/jackson-deserialization">bealdung tutorial</a>, that Jackson has already
          handled this use cas with a clean approach: in fact, what we really need is to
        </p>

        <div class="steps">
          <h3 class="step">
            Implement a new class that extends the <span class="code">StdDeserializer</span> abstract class
          </h3>

          <pre class="code" language="java">
                public class UserDeserializer extends StdDeserializer&lt;User&gt; {
                
                    public UserDeserializer() {
                        this(null);
                    }
                    
                    public UserDeserializer(Class&lt;?&gt; vc) {
                        super(vc);
                    }
                
                    @Override
                    public User deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException, JsonProcessingException {
                        JsonNode userNode = jsonParser.getCodec().readTree(jsonParser);
                        String username = userNode.get("username").asText();
                        String email = userNode.get("email").asText();
                        String website = userNode.get("website").asText();
                        JsonNode companyNode = userNode.get("company");
                        String company = companyNode.get("name").asText();
                        return new User(username, email, website, company);
                    }
                }
          </pre>

          <h3 class="step">Register this deserializer on the Jackson <span class="code">ObjectMapper</span> class</h3>

          <pre class="code" language="java">
                ObjectMapper mapper = new ObjectMapper();
                SimpleModule module = new SimpleModule();
                module.addDeserializer(User.class, new UserDeserializer());
                mapper.registerModule(module);
                User user = mapper.readValue(httpResponse, User.class);
          </pre>
        </div>

        <conclusion-webcomponent></conclusion-webcomponent>

        <more-info-webcomponent>
          <link-webcomponent
            href="https://github.com/ahenteti/ahenteti.github.io.demo/tree/master/java/jackson-jsondeserialize-demo"
            label="Article source code"
          ></link-webcomponent>
          <link-webcomponent
            href="https://www.baeldung.com/jackson-deserialization"
            label="bealdung jackson-deserialization article"
          ></link-webcomponent>
        </more-info-webcomponent>
      </article-webcomponent>
    </div>
  </body>
</html>
